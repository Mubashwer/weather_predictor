{
  "date": "<%= Time.now.strftime("%d-%m-%Y") %>",
  <% locs = Location.get_locs_by_postcode(params["postcode"]).map do |loc| %>
  <% loc_json = loc.as_json %>
  <% loc_json["measurements"] = 
	Observation.where("unix_time >= :unix_time_start AND 
	unix_time <= :unix_time_end AND location_id = :observation_location",
	unix_time_start: params["date"].to_time.to_i,
	unix_time_end: (params["date"].to_time + 1.day).to_i,
	observation_location: loc.id).as_json %>
  <% loc_json %>
  <% end %>
  "locations": <%= JSON.pretty_generate(locs.as_json).gsub(/^/, '  ')[1..-1].html_safe %>
  
}